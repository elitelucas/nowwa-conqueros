<html>
    <head>
        <style>
            button {
                width: 200px;
            }

            textarea {
                width: 600px; 
                height: 200px;
                resize: none;
            }

            input {
                width: 200px;
                height: 20px;
            }
            input[type="file"]:-webkit-file-upload-button {
                visibility: hidden;
                content: 'Select some files';
                width: 200px;
                height: 20px;
            }
        </style>
        <script>
            function Init () {

            }

            var logs = [];
            var maxLogs = 10;
            var port = 9876
            var url = `http://localhost:${port}`;

            function Log(log, isError) {
                logs.push(log);
                if (logs.length > maxLogs) logs.shift();
                var output = "";
                for (var i = 0; i < logs.length; i++) {
                    output += logs[i];
                    output += '\n';
                }
                if (isError) {
                    console.error(log);
                } else {
                    console.log(log);
                }
                document.getElementById(`output`).innerHTML = output;
            }

            async function Call (method, url, data) {
                try {
                    var response = await fetch (url, { 
                        method  : method,
                        body    : data
                    });
                    var data = await response.json();
                    Log(JSON.stringify(data));
                    return data;
                }
                catch (error) {
                    Log(error, true);
                    return null;
                }
            }

            async function CallGetDefault () {
                Log('call get default...');
                await Call("GET",url);
            }

            async function CallPostAuthenticate () {
                var username = document.getElementById('fld_username').value;
                var password = document.getElementById('fld_password').value;
                if (username.length == 0) {  
                    return Log('username cannot be empty!');
                }
                if (password.length == 0) {  
                    return Log('password cannot be empty!');
                } 
                Log('call post authenticate...');
                await Call("POST",url + "/authenticate", {username:username, password:password});
            }

            async function CallPostRegister () {
                var username = document.getElementById('fld_username').value;
                var password = document.getElementById('fld_password').value;
                var repassword = document.getElementById('fld_repassword').value;
                if (username.length == 0) {  
                    return Log('username cannot be empty!');
                }
                if (password.length == 0) {  
                    return Log('password cannot be empty!');
                } 
                if (repassword != password) {  
                    return Log('password mismatch!');
                }
                Log('call post register...');
                await Call("POST",url + "/register", {username:username, password:password});
            }

            async function CallPostUpload () {
                var filename = document.getElementById('fld_file').value;
                if (filename.length == 0) {  
                    return Log('file cannot be empty!');
                }
                let formData = new FormData();
                formData.append("fld_file", document.getElementById("fld_file").files[0]);
                Log('call post upload...');
                await Call("POST",url + "/upload", formData);
            }

            window.onload = Init;
        </script>
    </head>
    <body>
        <textarea id="output"></textarea>
        <br/><button onclick="CallGetDefault();">Default</button>
        <br/><button onclick="CallPostAuthenticate();">Authenticate</button><input placeholder="username" id="fld_username" type="text"><input placeholder="password" id="fld_password" type="password">
        <br/><button onclick="CallPostRegister();">Register</button><input placeholder="retype password" id="fld_repassword" type="password">
        <br/><button onclick="CallPostUpload();">Upload</button><input placeholder="select file" id="fld_file" type="file">
    </body>
</html>